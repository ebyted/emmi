{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Citas Agendadas</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#F5F5DC] p-8">

  <h1 class="text-4xl text-center text-[#9B8BB4] mb-8">Citas Agendadas</h1>

  <!-- Botones de filtro -->
  <div class="flex justify-center space-x-4 mb-8">
    <button data-origen="todos" onclick="filtrarCitas('todos')" class="btn-filtro px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded-lg">Mostrar Todos</button>
    <button data-origen="brow_design" onclick="filtrarCitas('brow_design')" class="btn-filtro px-4 py-2 bg-[#A7D2CB] hover:bg-teal-200 rounded-lg">Brow Design</button>
    <button data-origen="wellness_therapies" onclick="filtrarCitas('wellness_therapies')" class="btn-filtro px-4 py-2 bg-[#E6E6FA] hover:bg-indigo-100 rounded-lg">Wellness Therapies</button>
  </div>

  <!-- Renderizado dinámico -->
  {% for origen, citas_origen in citas_por_origen.items %}
    <div class="tabla-citas mb-12" data-origen="{{ origen }}">
      <h2 class="text-2xl font-semibold mb-4 text-center text-gray-700 capitalize">
        {% if origen == 'brow_design' %}
          Citas desde Brow Design
        {% elif origen == 'wellness_therapies' %}
          Citas desde Wellness Therapies
        {% else %}
          Citas desde {{ origen }}
        {% endif %}
      </h2>
      <table class="w-full table-auto bg-white rounded-lg shadow">
        <thead class="bg-[#E6E6FA]">
          <tr>
            <th class="px-4 py-2 text-left">Nombre</th>
            <th class="px-4 py-2 text-left">Email</th>
            <th class="px-4 py-2 text-left">Teléfono</th>
            <th class="px-4 py-2 text-left">Servicio</th>
            <th class="px-4 py-2 text-left">Mensaje</th>
            <th class="px-4 py-2 text-left">Fecha</th>
            <th class="px-4 py-2 text-left">Acciones</th> <!-- nuevo -->
          </tr>
        </thead>
        <tbody>
          {% for cita in citas_origen %}
            <tr class="border-b">
              <td class="px-4 py-2">{{ cita.nombre }}</td>
              <td class="px-4 py-2">{{ cita.email }}</td>
              <td class="px-4 py-2">{{ cita.telefono }}</td>
              <td class="px-4 py-2">{{ cita.servicio }}</td>
              <td class="px-4 py-2">{{ cita.mensaje }}</td>
              <td class="px-4 py-2">{{ cita.fecha_creacion|date:"d/m/Y H:i" }}</td>
              <td class="px-4 py-2">
                <form method="POST" action="{% url 'eliminar_cita' cita.id %}" onsubmit="return confirm('¿Eliminar esta cita?');">
                  {% csrf_token %}
                  <button type="submit" class="text-red-600 hover:underline">Eliminar</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endfor %}

  <script>
    function filtrarCitas(origen) {
      document.querySelectorAll('.tabla-citas').forEach(tabla => {
        tabla.style.display = (origen === 'todos' || tabla.dataset.origen === origen) ? 'block' : 'none';
      });

      document.querySelectorAll('.btn-filtro').forEach(btn => {
        btn.classList.remove('ring', 'ring-offset-2', 'ring-purple-400');
      });

      const activo = document.querySelector(`.btn-filtro[data-origen="${origen}"]`);
      if (activo) {
        activo.classList.add('ring', 'ring-offset-2', 'ring-purple-400');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      filtrarCitas('todos');
    });
  </script>

</body>
</html>
